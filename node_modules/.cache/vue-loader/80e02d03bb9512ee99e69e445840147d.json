{"remainingRequest":"/Users/medo/Downloads/code/ruoyi-cloud-view/ruoyi-ant/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/medo/Downloads/code/ruoyi-cloud-view/ruoyi-ant/src/views/system/OssList.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/medo/Downloads/code/ruoyi-cloud-view/ruoyi-ant/src/views/system/OssList.vue","mtime":1581646913799},{"path":"/Users/medo/Downloads/code/ruoyi-cloud-view/ruoyi-ant/node_modules/cache-loader/dist/cjs.js","mtime":1580791779218},{"path":"/Users/medo/Downloads/code/ruoyi-cloud-view/ruoyi-ant/node_modules/babel-loader/lib/index.js","mtime":1580791766093},{"path":"/Users/medo/Downloads/code/ruoyi-cloud-view/ruoyi-ant/node_modules/cache-loader/dist/cjs.js","mtime":1580791779218},{"path":"/Users/medo/Downloads/code/ruoyi-cloud-view/ruoyi-ant/node_modules/vue-loader/lib/index.js","mtime":1580791779864}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Vue from 'vue'\nimport { ACCESS_TOKEN } from '@/store/mutation-types'\nimport { STable, Ellipsis } from '@/components'\nimport { getOssList, delOss, saveOss } from '@/api/system'\nimport { checkPermission } from '@/utils/permissions'\nimport OssModal from './modules/OssConfigModal'\nexport default {\n  name: 'TableList',\n  components: {\n    STable,\n    Ellipsis,\n    OssModal\n  },\n  data () {\n    return {\n      visible: false,\n      labelCol: {\n        xs: { span: 24 },\n        sm: { span: 5 }\n      },\n      wrapperCol: {\n        xs: { span: 24 },\n        sm: { span: 16 }\n      },\n      form: this.$form.createForm(this),\n      mdl: {},\n      permissions: [],\n      // 高级搜索 展开/关闭\n      advanced: false,\n      // 查询参数\n      queryParam: {},\n      // 表头\n      columns: [\n        {\n          title: '文件名',\n          dataIndex: 'fileName',\n          scopedSlots: { customRender: 'fileName' }\n        },\n        {\n          title: '文件后缀',\n          dataIndex: 'fileSuffix'\n        },\n        {\n          title: '文件预览',\n          dataIndex: 'url',\n          scopedSlots: { customRender: 'url' }\n        },\n\n        {\n          title: '上传人',\n          dataIndex: 'createBy'\n        },\n        {\n          title: '服务商',\n          dataIndex: 'service',\n          scopedSlots: { customRender: 'service' }\n        },\n        {\n          title: '创建时间',\n          dataIndex: 'createTime',\n          sorter: true\n        },\n        {\n          title: '操作',\n          width: '150px',\n          dataIndex: 'action',\n          scopedSlots: { customRender: 'action' }\n        }\n      ],\n      range: null,\n      // 加载数据方法 必须为 Promise 对象\n      loadData: parameter => {\n        return getOssList(Object.assign(parameter, this.queryParam)).then(res => {\n          return res\n        })\n      },\n      selectedRowKeys: [],\n      selectedRows: [],\n      previewVisible: false,\n      uploadUrl: process.env.VUE_APP_API_BASE_URL + '/system/oss/upload',\n      headers: {\n        token: Vue.ls.get(ACCESS_TOKEN)\n      },\n      addEnable: checkPermission('system:oss:add'),\n      editEnabel: checkPermission('system:oss:edit'),\n      configEnabel: checkPermission('system:oss:config'),\n      removeEnable: checkPermission('system:oss:remove')\n\n    }\n  },\n  filters: {\n    serviceFilter (service) {\n      const serviceMap = {\n        1: '七牛云',\n        2: '阿里云',\n        3: '腾讯云'\n      }\n      return serviceMap[service]\n    }\n  },\n  beforeCreate () {\n\n  },\n  created () {\n  },\n  methods: {\n    previewCancel () {\n      this.previewVisible = false\n    },\n    handlePreview (url) {\n      this.previewImage = url\n      this.previewVisible = true\n    },\n    onSelectChange (selectedRowKeys, selectedRows) {\n      this.selectedRowKeys = selectedRowKeys\n      this.selectedRows = selectedRows\n    },\n    uploadChange (info) {\n      if (info.file.status !== 'uploading') {\n        console.log(info.file, info.fileList)\n      }\n      if (info.file.status === 'done') {\n        this.$refs.table.refresh(true)\n      }\n    },\n    handleOk () {\n      this.$refs.table.refresh(true)\n    },\n    handleEdit (record) {\n      this.$refs.modal.edit(record)\n    },\n    handleChange (value, key, column, record) {\n      console.log(value, key, column)\n      record[column] = value\n    },\n    edit (record) {\n      record.editable = true\n    },\n    cancel (record) {\n      record.editable = false\n    },\n    save (record) {\n      saveOss(record).then(res => {\n        if (res.code === 0) {\n          this.$message.success('保存成功')\n          record.editable = false\n        } else {\n          this.$message.success(res.msg)\n        }\n      }).catch(() => {\n        this.$message.error('系统错误，请稍后再试')\n      })\n    },\n    delByIds (ids) {\n      this.$confirm({\n        title: '提示',\n        content: '确定删除该条记录吗 ?',\n        onOk: () => {\n          delOss({ ids: ids.join(',') }).then(res => {\n            if (res.code === 0) {\n              this.$message.success(`删除成功`)\n              this.handleOk()\n            } else {\n              this.$message.error(res.msg)\n            }\n            this.selectedRowKeys = []\n          })\n        },\n        onCancel () {\n        }\n      })\n    }\n  },\n  watch: {\n    /*\n      'selectedRows': function (selectedRows) {\n        this.needTotalList = this.needTotalList.map(item => {\n          return {\n            ...item,\n            total: selectedRows.reduce( (sum, val) => {\n              return sum + val[item.dataIndex]\n            }, 0)\n          }\n        })\n      }\n      */\n  }\n}\n",{"version":3,"sources":["OssList.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"OssList.vue","sourceRoot":"src/views/system","sourcesContent":["<template>\n  <a-card :bordered=\"false\">\n    <div class=\"table-page-search-wrapper\">\n      <a-form layout=\"inline\">\n        <a-row :gutter=\"48\">\n          <a-col :md=\"4\" :sm=\"12\">\n            <a-form-item label=\"文件名：\">\n              <a-input placeholder=\"请输入\" v-model=\"queryParam.fileName\"/>\n            </a-form-item>\n          </a-col>\n          <a-col :md=\"4\" :sm=\"12\">\n            <a-form-item label=\"文件后缀：\">\n              <a-input placeholder=\"请输入\" v-model=\"queryParam.fileSuffix\"/>\n            </a-form-item>\n          </a-col>\n          <a-col :md=\"4\" :sm=\"12\">\n            <a-form-item label=\"上传人：\">\n              <a-input placeholder=\"请输入\" v-model=\"queryParam.createBy\"/>\n            </a-form-item>\n          </a-col>\n          <a-col :md=\"5\" :sm=\"15\">\n            <span class=\"table-page-search-submitButtons\">\n              <a-button type=\"primary\" @click=\"$refs.table.refresh(true)\">查询</a-button>\n              <a-button style=\"margin-left: 8px\" @click=\"() => queryParam = {}\">重置</a-button>\n            </span>\n          </a-col>\n        </a-row>\n      </a-form>\n    </div>\n    <div class=\"table-operator\">\n\n      <a-button v-if=\"configEnabel\" type=\"primary\" icon=\"setting\" @click=\"$refs.modal.config()\">云存储配置</a-button>\n      <a-dropdown v-if=\"removeEnable && selectedRowKeys.length > 0\">\n        <a-button type=\"danger\" icon=\"delete\" @click=\"delByIds(selectedRowKeys)\">删除</a-button>\n      </a-dropdown>\n      <a-upload\n        v-if=\"addEnable\"\n        name=\"file\"\n        :action=\"uploadUrl\"\n        :headers=\"headers\"\n        :showUploadList=\"false\"\n        @change=\"uploadChange\"\n      >\n        <a-button icon=\"upload\"> 文件上传</a-button>\n      </a-upload>\n    </div>\n    <s-table\n      size=\"default\"\n      ref=\"table\"\n      rowKey=\"id\"\n      :rowSelection=\"{selectedRowKeys: selectedRowKeys, onChange: onSelectChange}\"\n      :columns=\"columns\"\n      :data=\"loadData\"\n      :rangPicker=\"range\"\n      defaultSort=\"createTime\"\n    >\n      <template v-for=\"col in ['fileName']\" :slot=\"col\" slot-scope=\"text, record\">\n        <div :key=\"col \">\n          <a-input\n            v-if=\"record.editable\"\n            style=\"margin: -5px 0\"\n            :value=\"text\"\n            @change=\"e => handleChange(e.target.value, record.id, col, record)\"\n          />\n          <template v-else>{{ text }}</template>\n        </div>\n      </template>\n      <span slot=\"service\" slot-scope=\"text\">\n        {{ text | serviceFilter }}\n      </span>\n      <img style=\"width:30px;heigth:30px;cursor:pointer;\" slot=\"url\" slot-scope=\"text\" :src=\"text\" @click=\"handlePreview(text)\"/>\n      <template slot=\"action\" slot-scope=\"text, record\">\n        <div class=\"editable-row-operations\">\n          <span v-if=\"record.editable\">\n            <a @click=\"() => save(record)\">保存</a>\n            <a-divider type=\"vertical\" />\n            <a-popconfirm title=\"真的放弃编辑吗?\" @confirm=\"() => cancel(record)\">\n              <a>取消</a>\n            </a-popconfirm>\n          </span>\n          <span v-else>\n            <a @click=\"() => edit(record)\">编辑</a>\n            <a-divider type=\"vertical\" />\n            <a v-if=\"removeEnable\" @click=\"delByIds([record.id])\">删除</a>\n          </span>\n        </div>\n      </template>\n    </s-table>\n    <oss-modal ref=\"modal\" @ok=\"handleOk\"/>\n    <a-modal :visible=\"previewVisible\" :footer=\"null\" @cancel=\"previewCancel\">\n      <img style=\"width: 100%\" :src=\"previewImage\" />\n    </a-modal>\n  </a-card>\n</template>\n\n<script>\nimport Vue from 'vue'\nimport { ACCESS_TOKEN } from '@/store/mutation-types'\nimport { STable, Ellipsis } from '@/components'\nimport { getOssList, delOss, saveOss } from '@/api/system'\nimport { checkPermission } from '@/utils/permissions'\nimport OssModal from './modules/OssConfigModal'\nexport default {\n  name: 'TableList',\n  components: {\n    STable,\n    Ellipsis,\n    OssModal\n  },\n  data () {\n    return {\n      visible: false,\n      labelCol: {\n        xs: { span: 24 },\n        sm: { span: 5 }\n      },\n      wrapperCol: {\n        xs: { span: 24 },\n        sm: { span: 16 }\n      },\n      form: this.$form.createForm(this),\n      mdl: {},\n      permissions: [],\n      // 高级搜索 展开/关闭\n      advanced: false,\n      // 查询参数\n      queryParam: {},\n      // 表头\n      columns: [\n        {\n          title: '文件名',\n          dataIndex: 'fileName',\n          scopedSlots: { customRender: 'fileName' }\n        },\n        {\n          title: '文件后缀',\n          dataIndex: 'fileSuffix'\n        },\n        {\n          title: '文件预览',\n          dataIndex: 'url',\n          scopedSlots: { customRender: 'url' }\n        },\n\n        {\n          title: '上传人',\n          dataIndex: 'createBy'\n        },\n        {\n          title: '服务商',\n          dataIndex: 'service',\n          scopedSlots: { customRender: 'service' }\n        },\n        {\n          title: '创建时间',\n          dataIndex: 'createTime',\n          sorter: true\n        },\n        {\n          title: '操作',\n          width: '150px',\n          dataIndex: 'action',\n          scopedSlots: { customRender: 'action' }\n        }\n      ],\n      range: null,\n      // 加载数据方法 必须为 Promise 对象\n      loadData: parameter => {\n        return getOssList(Object.assign(parameter, this.queryParam)).then(res => {\n          return res\n        })\n      },\n      selectedRowKeys: [],\n      selectedRows: [],\n      previewVisible: false,\n      uploadUrl: process.env.VUE_APP_API_BASE_URL + '/system/oss/upload',\n      headers: {\n        token: Vue.ls.get(ACCESS_TOKEN)\n      },\n      addEnable: checkPermission('system:oss:add'),\n      editEnabel: checkPermission('system:oss:edit'),\n      configEnabel: checkPermission('system:oss:config'),\n      removeEnable: checkPermission('system:oss:remove')\n\n    }\n  },\n  filters: {\n    serviceFilter (service) {\n      const serviceMap = {\n        1: '七牛云',\n        2: '阿里云',\n        3: '腾讯云'\n      }\n      return serviceMap[service]\n    }\n  },\n  beforeCreate () {\n\n  },\n  created () {\n  },\n  methods: {\n    previewCancel () {\n      this.previewVisible = false\n    },\n    handlePreview (url) {\n      this.previewImage = url\n      this.previewVisible = true\n    },\n    onSelectChange (selectedRowKeys, selectedRows) {\n      this.selectedRowKeys = selectedRowKeys\n      this.selectedRows = selectedRows\n    },\n    uploadChange (info) {\n      if (info.file.status !== 'uploading') {\n        console.log(info.file, info.fileList)\n      }\n      if (info.file.status === 'done') {\n        this.$refs.table.refresh(true)\n      }\n    },\n    handleOk () {\n      this.$refs.table.refresh(true)\n    },\n    handleEdit (record) {\n      this.$refs.modal.edit(record)\n    },\n    handleChange (value, key, column, record) {\n      console.log(value, key, column)\n      record[column] = value\n    },\n    edit (record) {\n      record.editable = true\n    },\n    cancel (record) {\n      record.editable = false\n    },\n    save (record) {\n      saveOss(record).then(res => {\n        if (res.code === 0) {\n          this.$message.success('保存成功')\n          record.editable = false\n        } else {\n          this.$message.success(res.msg)\n        }\n      }).catch(() => {\n        this.$message.error('系统错误，请稍后再试')\n      })\n    },\n    delByIds (ids) {\n      this.$confirm({\n        title: '提示',\n        content: '确定删除该条记录吗 ?',\n        onOk: () => {\n          delOss({ ids: ids.join(',') }).then(res => {\n            if (res.code === 0) {\n              this.$message.success(`删除成功`)\n              this.handleOk()\n            } else {\n              this.$message.error(res.msg)\n            }\n            this.selectedRowKeys = []\n          })\n        },\n        onCancel () {\n        }\n      })\n    }\n  },\n  watch: {\n    /*\n      'selectedRows': function (selectedRows) {\n        this.needTotalList = this.needTotalList.map(item => {\n          return {\n            ...item,\n            total: selectedRows.reduce( (sum, val) => {\n              return sum + val[item.dataIndex]\n            }, 0)\n          }\n        })\n      }\n      */\n  }\n}\n</script>\n"]}]}